{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\u200b\\-]"},"docs":[{"location":"","text":"F5 BIG-IP kubernetes Gateway online docs \u00b6 Welcome. This is the online docs of F5 BIG-IP kubernetes Gateway. F5 BIG-IP kubernetes Gateway is an implementation of K8S Gateway API . Source code of the project: https://github.com/F5Networks/bigip-kubernetes-gateway Any questions, kindly Please Contact us . Click here , see the latest release.","title":"Overview"},{"location":"#f5-big-ip-kubernetes-gateway-online-docs","text":"Welcome. This is the online docs of F5 BIG-IP kubernetes Gateway. F5 BIG-IP kubernetes Gateway is an implementation of K8S Gateway API . Source code of the project: https://github.com/F5Networks/bigip-kubernetes-gateway Any questions, kindly Please Contact us . Click here , see the latest release.","title":"F5 BIG-IP kubernetes Gateway online docs"},{"location":"Architecture/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"Overview"},{"location":"Architecture/#check-later","text":"","title":"Check later"},{"location":"Architecture/#1-xxx","text":"We will be back","title":"1. XXX"},{"location":"Architecture/gatewayclassrefer/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"GatewayClass parametersRef"},{"location":"Architecture/gatewayclassrefer/#check-later","text":"","title":"Check later"},{"location":"Architecture/gatewayclassrefer/#1-xxx","text":"We will be back","title":"1. XXX"},{"location":"Architecture/parameters/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"Controller parameters"},{"location":"Architecture/parameters/#check-later","text":"","title":"Check later"},{"location":"Architecture/parameters/#1-xxx","text":"We will be back","title":"1. XXX"},{"location":"Operation-and-troubleshooting/ki/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"Common FAQ"},{"location":"Operation-and-troubleshooting/ki/#check-later","text":"","title":"Check later"},{"location":"Operation-and-troubleshooting/ki/#1-xxx","text":"We will be back","title":"1. XXX"},{"location":"Operation-and-troubleshooting/trubeshooting/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"Troubleshooting"},{"location":"Operation-and-troubleshooting/trubeshooting/#check-later","text":"","title":"Check later"},{"location":"Operation-and-troubleshooting/trubeshooting/#1-xxx","text":"We will be back","title":"1. XXX"},{"location":"Release-notes/","text":"Release \u00b6 We will release the first version soon. Check later.","title":"Releases"},{"location":"Release-notes/#release","text":"We will release the first version soon. Check later.","title":"Release"},{"location":"Support-and-contact/","text":"Support and contact \u00b6 For the gateway controller support: \u00b6 Currently please raise your questions or issues by github Issues For the online docs support: \u00b6 Currently please raise your questions or issues by github Issues Welcome contact us by below ways: \u00b6 Slack channel (forl global users) Wechat group (for China Wechat users only)","title":"Tech Support"},{"location":"Support-and-contact/#support-and-contact","text":"","title":"Support and contact"},{"location":"Support-and-contact/#for-the-gateway-controller-support","text":"Currently please raise your questions or issues by github Issues","title":"For the gateway controller support:"},{"location":"Support-and-contact/#for-the-online-docs-support","text":"Currently please raise your questions or issues by github Issues","title":"For the online docs support:"},{"location":"Support-and-contact/#welcome-contact-us-by-below-ways","text":"Slack channel (forl global users) Wechat group (for China Wechat users only)","title":"Welcome contact us by below ways:"},{"location":"Support-and-contact/contributions/","text":"Wecome any contributions \u00b6 For online docs, kindly pls PR to https://github.com/f5se/bigip-gatewayapi-docs For coding contribution kindly pls refer the guide in https://github.com/F5Networks/bigip-kubernetes-gateway Here are the contributors for now\uff1a zongzw f5zong Niklaus-xie myf5 Jing Lin","title":"Wecome any contributions"},{"location":"Support-and-contact/contributions/#wecome-any-contributions","text":"For online docs, kindly pls PR to https://github.com/f5se/bigip-gatewayapi-docs For coding contribution kindly pls refer the guide in https://github.com/F5Networks/bigip-kubernetes-gateway Here are the contributors for now\uff1a zongzw f5zong Niklaus-xie myf5 Jing Lin","title":"Wecome any contributions"},{"location":"Use-Cases/advancedhttp/","text":"1.\u6807\u51c6HTTPS\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u6700\u5e38\u7528\u7684HTTPS\u4e1a\u52a1\u53d1\u5e03\uff0c\u524d\u7aef\u4f7f\u7528HTTPS\uff0c\u5bfc\u5165\u5e76\u914d\u7f6e\u670d\u52a1\u5668\u8bc1\u4e66\u548c\u5bc6\u94a5\uff0c\u540e\u7aef\u4f7f\u7528HTTP\uff0c\u5b9e\u73b0SSL Offloading\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\" }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:https ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 41 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } sys crypto cert cafe/coffeecert.crt { cert-validation-options none cert-validators { { } } certificate-key-size 2048 city HZ common-name coffee.example.com country CN email-address expiration Jul 31 07:23:41 2032 GMT fingerprint SHA256/D6:7A:CB:DA:2D:48:A1:21:27:15:39:5A:24:58:56:00:4E:53:A2:55:F8:AF:F1:DB:DF:07:AB:85:68:76:AD:AF issuer CN=coffee.example.com,OU=Test,O=F5,L=HZ,ST=ZJ,C=CN issuer-certificate organization F5 ou Test public-key-type RSA state ZJ subject-alternative-name } sys crypto key cafe/coffeecert.key { key-size 2048 key-type rsa-private security-type normal } ltm virtual cafe/https_vs-Redirect- { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:http ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { /Common/_sys_https_redirect } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 42 } \u8bf7\u6ce8\u610f\u6700\u540e\u4e00\u4e2aHTTP\u7684VS\uff0c cafe/https_vs-Redirect- \uff0c\u8fd9\u662fAS3\u81ea\u52a8\u751f\u6210\u7684\uff0c\u7528\u4e8eHTTP\u7684\u8df3\u8f6c\uff0c\u5982\u679c\u4e0d\u9700\u8981\u81ea\u52a8\u751f\u6210\u8fd9\u4e2aVS\uff0c\u8bf7\u5728AS3\u4e2d\u52a0\u5165\u4ee5\u4e0b\u53c2\u6570\uff1a \"redirect80\": false \u5b8c\u6574\u7684YAML\u5982\u4e0b\uff1a kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } } 2.\u7aef\u5230\u7aef\u52a0\u5bc6 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 F5\u5e76\u4e0d\u505aSSL\u5378\u8f7d\uff0c\u5728SSL\u89e3\u5bc6\u540e\uff0c\u8fde\u63a5\u540e\u7aef\u771f\u5b9e\u670d\u52a1\u5668\u65f6\u518d\u91cd\u65b0\u52a0\u5bc6\u3002\u8fd9\u4e2a\u529f\u80fd\u9002\u7528\u4e8e\u5e94\u7528\u9700\u8981\u7aef\u5230\u7aef\u52a0\u5bc6\uff0c\u4f46\u53c8\u9700\u8981F5\u505a\u4e00\u4e9b\u53cd\u4ee3\u6216\u80057\u5c42\u5b89\u5168\u7684\u573a\u666f\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"End to end encryption\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.12\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"clientTLS\": \"coffeetls-server\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"coffeetls-server\" :{ \"class\": \"TLS_Client\" } } } } } \u5728F5\u7684\u914d\u7f6e\u4e2d\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u901a\u8fc7vs\u6302\u8f7dserver-ssl profile\u6765\u5b9e\u73b0\u7684\uff0c \u4f46\u8bf7\u6ce8\u610f \uff0c\u5728AS3\u58f0\u660e\u4e2d\uff0c\u5bf9\u4e8eClient\u548cServer\u7684\u5b9a\u4e49\u548cF5\u914d\u7f6e\u4e2d\u7684client-ssl\u548cserver-ssl\u662f\u76f8\u53cd\u7684\u3002 \u5728\u4e0a\u8ff0AS3\u58f0\u660e\u4e2d\uff0c \"serverTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684client-ssl profile\uff0c \"clientTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684server-ssl profile\u3002 \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:26:14 description cafe destination 192.0.2.12:https ip-protocol tcp last-modified-time 2022-08-19:16:26:14 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } cafe/coffeetls-server { context serverside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 54 } ltm profile server-ssl cafe/coffeetls-server { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once authenticate-name none c3d-cert-extension-includes { basic-constraints extended-key-usage key-usage subject-alternative-name } c3d-cert-lifespan 24 ca-file /Common/ca-bundle.crt cache-timeout 3600 cipher-group none ciphers DEFAULT expire-cert-response-control drop peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none session-ticket disabled ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled untrusted-cert-response-control drop } 3.\u8c03\u7528\u5df2\u6709\u8bc1\u4e66 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u4e0a\u9762\u7684\u8303\u4f8b\u4e2d\u6211\u4eec\u90fd\u662f\u901a\u8fc7AS3\u521b\u5efa\u8bc1\u4e66\u7684\u548c\u5bc6\u94a5\uff0c\u4f46\u5b9e\u9645\u4f7f\u7528\u5f53\u4e2d\u6211\u4eec\u53ef\u80fd\u4f1a\u591a\u4e2a\u5e94\u7528\u5171\u7528\u4e00\u5f20\u8bc1\u4e66\uff0c\u4f8b\u5982\u6cdb\u57df\u540d\u8bc1\u4e66\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u521b\u5efa\u8bc1\u4e66\u548c\u5bc6\u94a5\u4e00\u6b21\u5373\u53ef\u3002\u4e0b\u9762\u7684\u8303\u4f8b\u6211\u4eec\u4f1a\u4f7f\u7528/Common\u5206\u533a\u4e0b\u5df2\u6709\u7684\u8bc1\u4e66\u548c\u5bc6\u94a5\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Use existing cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.13\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"cafecert\" }] }, \"cafecert\": { \"class\": \"Certificate\", \"remark\": \"cafe.example.com\", \"certificate\": { \"bigip\": \"/Common/cafe.example.com\" }, \"privateKey\": { \"bigip\": \"/Common/cafe.example.com\" } } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:32:53 description cafe destination 192.0.2.13:https ip-protocol tcp last-modified-time 2022-08-19:16:32:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 55 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert /Common/cafe.example.com cert-key-chain { cafe.example { cert /Common/cafe.example.com key /Common/cafe.example.com } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/cafe.example.com ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } 4.\u6839\u636eSNI\u5339\u914d\u8bc1\u4e66 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u5728\u4e00\u4e2a\u865a\u62df\u670d\u52a1\u4e0a\u7ed1\u5b9a\u591a\u5f20\u8bc1\u4e66\uff0cF5\u6839\u636eSNI\u6765\u81ea\u52a8\u5339\u914d\u8bc1\u4e66\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"One https vs with multiple SSL cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.14\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ],kube \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [ { \"matchToSNI\": \"coffee.example.com\", \"certificate\": \"coffeecert\" }, { \"matchToSNI\": \"tea.example.com\", \"certificate\": \"teacert\" } ] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"teacert\": { \"class\": \"Certificate\", \"remark\": \"tea.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDNjCCAh6gAwIBAgIEF6yK6DANBgkqhkiG9w0BAQsFADBdMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEYMBYGA1UEAxMPdGVhLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA4NDg0\\nMFoXDTMyMDczMTA4NDg0MFowXTELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpKMQsw\\nCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGDAWBgNVBAMT\\nD3RlYS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB\\nAOxIFhA7yv1p4gzcbWR4x07f0zhKH8VfyWTRnw7QjZFUjNLbEa7bOhQt53V9oCSR\\nol/8tY22CmBSAtlmTt5FX5H6W6naU8EAZUmwHO3eXjp/a1HUk0fj4D++dJ8KEF0b\\nT2fxq4H+jYoTDE/Nr4u9TExuZfU/tcMsF3PrgIfkjydjW7peyJoxhvLt4tyk8z3a\\nkfSgs6mjlBuc5/2Y1tIStRpJ7gl+eKueDHp4ogPnx5qcg+GAM1pYiv17wKVJzcHW\\nDor0B4xVi3CQWlUlTwW1TX+pwL0JkoOOPfbNYo67G43DmG8m3WNG+FH+aIGXhyyp\\ncy4zbum4d1HZI/zp+k7qd6ECAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAlfg7nBJL\\nDQWDGjczOjZjOcHrM7jbfuadmZQAgmASGRLMaHNuj8RIG+Ro+znM6QYNB7S8E4ZF\\ntjfvamSoFSB5+YoOwFZlyWyiHhW1L22HB7G2JabtBhexWURNfsjrwkROGpRBqjGz\\neuq4x/kkRYkOGhWGyXmJQmPo2FjO2g4R1zIRGEMeij0xpPuYIZsA6BOuyYiJPvi0\\nFBSsc+udZqOz9/MzcrU2mmIX0N42XudhWbiXNe6izPvBsrztJoZA8gaHn99JgZcZ\\ngKLYKl6FW4aN5mh2XGwuS+smbD37vr4J3faZg+18KN+H6g8mbF/ArPxKP9fiM9u9\\npKTWOTrCU0hJkw==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDsSBYQO8r9aeIM\\n3G1keMdO39M4Sh/FX8lk0Z8O0I2RVIzS2xGu2zoULed1faAkkaJf/LWNtgpgUgLZ\\nZk7eRV+R+lup2lPBAGVJsBzt3l46f2tR1JNH4+A/vnSfChBdG09n8auB/o2KEwxP\\nza+LvUxMbmX1P7XDLBdz64CH5I8nY1u6XsiaMYby7eLcpPM92pH0oLOpo5QbnOf9\\nmNbSErUaSe4Jfnirngx6eKID58eanIPhgDNaWIr9e8ClSc3B1g6K9AeMVYtwkFpV\\nJU8FtU1/qcC9CZKDjj32zWKOuxuNw5hvJt1jRvhR/miBl4csqXMuM27puHdR2SP8\\n6fpO6nehAgMBAAECggEAYScGw2gCgA5AXy9nX2917A2GKNf5lktbYLP8ZbgE7aPJ\\nP43KCI6lo9R4HkwoQ8EJ9dPPxtP6Ej7GYyN4/FWkBT7e38kgtPP3scPTMU9EiWMI\\n+p2gbWfaNfuWsioOLmpjTQcGkS3cftB0OIAHVTrhm2+tRpkKoJSJlCVaNQYagoPC\\nzhns8KJceDnyRikRfH0RbPPGsLLohnRYPDEs6J0yCXvUhKxsFKXq/mL0licu9KZN\\nqUwX2/TmT8iDnoC+TBkYJk055llBv16l5Hx7egYD9uNEFk76SInC2MCHpl1nlp43\\nEp5uRUsaCjS+5tpqugQPelhFQC9v7l4t4x+3xH/XPQKBgQD7riYMLVCNnSH3zRH8\\nYOwwFqGVSngTZw1hlTd06HEzUpntlHaoO3Z9pH2XWgaPF+2e2Hngm7EMNe5qjZau\\nlyOqb85UCxuAs0wLlLD/Q4sWOGmEPrkIHmKXHMZjQMjtqCkKr//zvE0W9ADo2MLm\\nawTxj45gTZxGXvuTEnMMkaflKwKBgQDwVkcXIJImgK+JXEjM1rGeypONVCnAqo7p\\nFJq2/QAraGvlNLv1QBzE6s4uqwWfzCecICQOoNrLG0dE3mHIlYgVqOK5Li9CJcsB\\n6dfEzgQyT4hotghCC/udjkAvKskXd4ShXbRSvF3p3elZDgXfAbQ5bxIL4QIOJF6f\\nd5os2LqIYwKBgQC3thDzxogMNuy6kyhTzvPYzkw4S1mG4Cw2VNNcNOecjOjrMPnE\\nJ1OAtvct6XrsLI04689bEoqT3TIg+SVKX+ya1m4HjuwOb9JMiccBLW5zU85Bx/8M\\nXBGfOFPf00RXpe3/bSUp5wNmg8m+LatmwiujoCRPS5eNDnwYiNkODaw+bQKBgG5Z\\nfvysdM5+6ZotKDP9I8LgCo2qph0TctisIDmCwvArWtb7to1t6Ye0tASTe9qaN1ml\\nHEknLC5zkO6bGNSra7deOvOBtCswBR0UzIBNg3nCMMS7R+FjdR0rcmb1wy0mMFyT\\nFLekS46U2I6ONL3nH2P7jpKrtnDd3CBmHwEWZdc3AoGBAM6ssZsvW47BGBbYNu7x\\nwEE0ehL/lesNQK9qEvBbtQ3w8ta5M9QHNu0vg05A6Pv+fLhSA+RuutAnF+bqBMpA\\nRM3JjvSRiMO51nISmVNl9Hga3vVvlUc7FDomv+KHc/RE6FqRdDRRvflErKb4sWDa\\nV4BS1wQmnyROovJMDN0A/mVi\\n-----END PRIVATE KEY-----\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:38:34 description cafe destination 192.0.2.14:https ip-protocol tcp last-modified-time 2022-08-19:16:38:34 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } cafe/cafetls-1- { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 56 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name coffee.example.com sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } ltm profile client-ssl cafe/cafetls-1- { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/teacert.crt cert-key-chain { teacert { cert cafe/teacert.crt key cafe/teacert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/teacert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name tea.example.com sni-default false sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } 5.\u53cc\u5411\u8ba4\u8bc1 \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u9664\u4e86\u51fa\u793a\u670d\u52a1\u5668\u8bc1\u4e66\u5916\uff0c\u5e94\u7528\u8fd8\u9700\u8981\u5bf9\u5ba2\u6237\u7aef\u8fdb\u884c\u8bc1\u4e66\u8ba4\u8bc1\uff0c\u9700\u8981\u5728F5\u4e0a\u914d\u7f6eCA\u8bc1\u4e66\u3002 \u53c2\u8003YAML \u00b6 kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"HTTPS with bidirection auth\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.15\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }], \"authenticationMode\": \"require\", \"authenticationFrequency\": \"every-time\", \"authenticationTrustCA\": \"coffeeca\" }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": { \"bigip\": \"/Common/default.crt\" }, \"privateKey\": { \"bigip\": \"/Common/default.key\" } }, \"coffeeca\": { \"class\": \"CA_Bundle\", \"bundle\": { \"bigip\": \"/Common/ca-bundle.crt\" } } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 ltm virtual cafe/https_vs { creation-time 2022-08-19:16:47:53 description cafe destination 192.0.2.15:https ip-protocol tcp last-modified-time 2022-08-19:16:47:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 57 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate always c3d-drop-unknown-ocsp-status drop ca-file /Common/ca-bundle.crt cache-timeout 3600 cert /Common/default.crt cert-key-chain { default { cert /Common/default.crt key /Common/default.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/default.key ocsp-stapling disabled peer-cert-mode require renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"Advancedhttp"},{"location":"Use-Cases/advancedhttp/#1https","text":"","title":"1.\u6807\u51c6HTTPS\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/advancedhttp/#_1","text":"\u6700\u5e38\u7528\u7684HTTPS\u4e1a\u52a1\u53d1\u5e03\uff0c\u524d\u7aef\u4f7f\u7528HTTPS\uff0c\u5bfc\u5165\u5e76\u914d\u7f6e\u670d\u52a1\u5668\u8bc1\u4e66\u548c\u5bc6\u94a5\uff0c\u540e\u7aef\u4f7f\u7528HTTP\uff0c\u5b9e\u73b0SSL Offloading\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/advancedhttp/#yaml","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\" }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/advancedhttp/#_2","text":"ltm virtual cafe/https_vs { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:https ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 41 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } sys crypto cert cafe/coffeecert.crt { cert-validation-options none cert-validators { { } } certificate-key-size 2048 city HZ common-name coffee.example.com country CN email-address expiration Jul 31 07:23:41 2032 GMT fingerprint SHA256/D6:7A:CB:DA:2D:48:A1:21:27:15:39:5A:24:58:56:00:4E:53:A2:55:F8:AF:F1:DB:DF:07:AB:85:68:76:AD:AF issuer CN=coffee.example.com,OU=Test,O=F5,L=HZ,ST=ZJ,C=CN issuer-certificate organization F5 ou Test public-key-type RSA state ZJ subject-alternative-name } sys crypto key cafe/coffeecert.key { key-size 2048 key-type rsa-private security-type normal } ltm virtual cafe/https_vs-Redirect- { creation-time 2022-08-03:15:25:38 description cafe destination 192.0.2.11:http ip-protocol tcp last-modified-time 2022-08-03:15:25:38 mask 255.255.255.255 partition cis-c-6 pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { /Common/_sys_https_redirect } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 42 } \u8bf7\u6ce8\u610f\u6700\u540e\u4e00\u4e2aHTTP\u7684VS\uff0c cafe/https_vs-Redirect- \uff0c\u8fd9\u662fAS3\u81ea\u52a8\u751f\u6210\u7684\uff0c\u7528\u4e8eHTTP\u7684\u8df3\u8f6c\uff0c\u5982\u679c\u4e0d\u9700\u8981\u81ea\u52a8\u751f\u6210\u8fd9\u4e2aVS\uff0c\u8bf7\u5728AS3\u4e2d\u52a0\u5165\u4ee5\u4e0b\u53c2\u6570\uff1a \"redirect80\": false \u5b8c\u6574\u7684YAML\u5982\u4e0b\uff1a kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Normal https\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.11\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" } } } } }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/advancedhttp/#2","text":"","title":"2.\u7aef\u5230\u7aef\u52a0\u5bc6"},{"location":"Use-Cases/advancedhttp/#_3","text":"F5\u5e76\u4e0d\u505aSSL\u5378\u8f7d\uff0c\u5728SSL\u89e3\u5bc6\u540e\uff0c\u8fde\u63a5\u540e\u7aef\u771f\u5b9e\u670d\u52a1\u5668\u65f6\u518d\u91cd\u65b0\u52a0\u5bc6\u3002\u8fd9\u4e2a\u529f\u80fd\u9002\u7528\u4e8e\u5e94\u7528\u9700\u8981\u7aef\u5230\u7aef\u52a0\u5bc6\uff0c\u4f46\u53c8\u9700\u8981F5\u505a\u4e00\u4e9b\u53cd\u4ee3\u6216\u80057\u5c42\u5b89\u5168\u7684\u573a\u666f\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/advancedhttp/#yaml_1","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"End to end encryption\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.12\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"clientTLS\": \"coffeetls-server\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"coffeetls-server\" :{ \"class\": \"TLS_Client\" } } } } } \u5728F5\u7684\u914d\u7f6e\u4e2d\uff0c\u8fd9\u4e2a\u529f\u80fd\u662f\u901a\u8fc7vs\u6302\u8f7dserver-ssl profile\u6765\u5b9e\u73b0\u7684\uff0c \u4f46\u8bf7\u6ce8\u610f \uff0c\u5728AS3\u58f0\u660e\u4e2d\uff0c\u5bf9\u4e8eClient\u548cServer\u7684\u5b9a\u4e49\u548cF5\u914d\u7f6e\u4e2d\u7684client-ssl\u548cserver-ssl\u662f\u76f8\u53cd\u7684\u3002 \u5728\u4e0a\u8ff0AS3\u58f0\u660e\u4e2d\uff0c \"serverTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684client-ssl profile\uff0c \"clientTLS\" \u5bf9\u5e94\u7684\u662fF5\u4e0a\u7684server-ssl profile\u3002","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/advancedhttp/#_4","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:26:14 description cafe destination 192.0.2.12:https ip-protocol tcp last-modified-time 2022-08-19:16:26:14 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } cafe/coffeetls-server { context serverside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 54 } ltm profile server-ssl cafe/coffeetls-server { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once authenticate-name none c3d-cert-extension-includes { basic-constraints extended-key-usage key-usage subject-alternative-name } c3d-cert-lifespan 24 ca-file /Common/ca-bundle.crt cache-timeout 3600 cipher-group none ciphers DEFAULT expire-cert-response-control drop peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none session-ticket disabled ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled untrusted-cert-response-control drop }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/advancedhttp/#3","text":"","title":"3.\u8c03\u7528\u5df2\u6709\u8bc1\u4e66"},{"location":"Use-Cases/advancedhttp/#_5","text":"\u4e0a\u9762\u7684\u8303\u4f8b\u4e2d\u6211\u4eec\u90fd\u662f\u901a\u8fc7AS3\u521b\u5efa\u8bc1\u4e66\u7684\u548c\u5bc6\u94a5\uff0c\u4f46\u5b9e\u9645\u4f7f\u7528\u5f53\u4e2d\u6211\u4eec\u53ef\u80fd\u4f1a\u591a\u4e2a\u5e94\u7528\u5171\u7528\u4e00\u5f20\u8bc1\u4e66\uff0c\u4f8b\u5982\u6cdb\u57df\u540d\u8bc1\u4e66\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u53ea\u9700\u8981\u521b\u5efa\u8bc1\u4e66\u548c\u5bc6\u94a5\u4e00\u6b21\u5373\u53ef\u3002\u4e0b\u9762\u7684\u8303\u4f8b\u6211\u4eec\u4f1a\u4f7f\u7528/Common\u5206\u533a\u4e0b\u5df2\u6709\u7684\u8bc1\u4e66\u548c\u5bc6\u94a5\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/advancedhttp/#yaml_2","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"Use existing cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.13\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"cafecert\" }] }, \"cafecert\": { \"class\": \"Certificate\", \"remark\": \"cafe.example.com\", \"certificate\": { \"bigip\": \"/Common/cafe.example.com\" }, \"privateKey\": { \"bigip\": \"/Common/cafe.example.com\" } } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/advancedhttp/#_6","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:32:53 description cafe destination 192.0.2.13:https ip-protocol tcp last-modified-time 2022-08-19:16:32:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 55 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert /Common/cafe.example.com cert-key-chain { cafe.example { cert /Common/cafe.example.com key /Common/cafe.example.com } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/cafe.example.com ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/advancedhttp/#4sni","text":"","title":"4.\u6839\u636eSNI\u5339\u914d\u8bc1\u4e66"},{"location":"Use-Cases/advancedhttp/#_7","text":"\u5728\u4e00\u4e2a\u865a\u62df\u670d\u52a1\u4e0a\u7ed1\u5b9a\u591a\u5f20\u8bc1\u4e66\uff0cF5\u6839\u636eSNI\u6765\u81ea\u52a8\u5339\u914d\u8bc1\u4e66\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/advancedhttp/#yaml_3","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"One https vs with multiple SSL cert\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.14\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"cafetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ],kube \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"cafetls\": { \"class\": \"TLS_Server\", \"certificates\": [ { \"matchToSNI\": \"coffee.example.com\", \"certificate\": \"coffeecert\" }, { \"matchToSNI\": \"tea.example.com\", \"certificate\": \"teacert\" } ] }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDPDCCAiSgAwIBAgIEF6x2/TANBgkqhkiG9w0BAQsFADBgMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEbMBkGA1UEAxMSY29mZmVlLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA3\\nMjM0MVoXDTMyMDczMTA3MjM0MVowYDELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpK\\nMQswCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGzAZBgNV\\nBAMTEmNvZmZlZS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC\\nAQoCggEBAOg2bcgZP1hCWIGnWikq8hivZq130nfXsyDijf0VpkvfHDmVdfEIyz9k\\nhRVVgCTtw5jllGsGZ4O+0jEx+bGGwAUgztH/318IW+EUFd928jaUwgYiWqSwbtgk\\nHjEUH30U9bXz1nvFISOjU33imbJsDq4Rjvq3/YxelMeRFw0xgMAWiyEFnbVU41cQ\\nFP6+PqZbJ1/wZ4nhTWnJGmYvEmtQ2Fh27JGQjkqrKp22PV8c8tds8+CyCbi/6zOR\\nJExj2zQ/zuOIVgm26z75OSsuRf+W7dFA0Li6zUdk7y1iw3Y/yI4I+htfORTum8SM\\nzG99ssbuE2lNQJ2Zh4tVz9bHwOU2+p8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEA\\nQrzflgFiNs1pA4ou/1+q2o59/cw6ga5MXWbjVDCh34w9okpzNnEmPlBlvLiLykSV\\n5H7u6pnNP1EUPdDe+Cleg0E2Om0pIwuvmBc8YT8AADfE+znGb/OUEQOZ4pGSbxeQ\\nZX5/H5Ie4UszfcEPfNnBerMRX6OBy39RjIQBTvioSMCu4agfzY8eubQfDwBpRb/o\\n+hOh2IB/fnr7zxbs7qSBiTktXsspfa3nezrdNQ+iXdTRPrBit+2j67CrvKpBoRKe\\nauY+7woPVDVJYjeAmy5Ly8zZUoGDlpRwKEtTu48108Cg3bISLhqycX18ZpZ2BA1N\\nu+QU1Yn3RaGFSU/8DCJxtQ==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDoNm3IGT9YQliB\\np1opKvIYr2atd9J317Mg4o39FaZL3xw5lXXxCMs/ZIUVVYAk7cOY5ZRrBmeDvtIx\\nMfmxhsAFIM7R/99fCFvhFBXfdvI2lMIGIlqksG7YJB4xFB99FPW189Z7xSEjo1N9\\n4pmybA6uEY76t/2MXpTHkRcNMYDAFoshBZ21VONXEBT+vj6mWydf8GeJ4U1pyRpm\\nLxJrUNhYduyRkI5Kqyqdtj1fHPLXbPPgsgm4v+szkSRMY9s0P87jiFYJtus++Tkr\\nLkX/lu3RQNC4us1HZO8tYsN2P8iOCPobXzkU7pvEjMxvfbLG7hNpTUCdmYeLVc/W\\nx8DlNvqfAgMBAAECggEASSUH7J1DTkZLwb9Yz5nm+26YrbCOG9DWbFfguOUuZjzH\\nk73oEj4eY4ACyacOf9NjJtC+MP4p8h5T8EoZKFnVN2hPrWdnUXR9GIduol7Byf6O\\npUcB/VlT+QJbfkMj7g8BnMhLed4s46BpRsBvgHu4Hg2K15/IHoSWYcxqke3Ta+20\\nQo/cJxfgr5lHtae6XXBnp/Mu+vMuQZxFAz5TR6bWPjwRqyok8Mk1JK9we0nEJm8U\\nml66N9i0UerhvIyFXUMww+846J/HnyrRvz0j5EnYmcquDw3DMMXzpssYCzamueny\\nMgiD6VujfT6pQ/ClQQHZf3+naDPA6dz4zeVOwxvquQKBgQD8FNvObw4TI2ZRNlIW\\nv6By4JWAIut25NI6r6+UXMYHbKxP7bI97P1SQMV+kGdVxiKJ366BM18WlzOIurJy\\nFKtE6QaggEZYN/duotA+jt3MygyXg2gu2wEpBzIwgxxRbR05pQLlsLtbSxKlpfZV\\nk5trX0ZQ2eaUw0ITb43rsJ7VdwKBgQDr0oDeQv8FPCbsmgGeX0UWLP1aBeCJZNub\\n15E5vXAy22fmsJTuAh7kvyyEHe4c/maug44VFEahn2H+6H2YGdzZTmGHzcxDpjSe\\nIVQswxNCxpdgo/w5aR7M9Ewn5ollZotO0eIzj0MVaETW6UBqYX8oRgicpHC4KrKM\\nGMabZJ1uGQKBgQCUZts4XpzUm4SCzw3ooouc1aZttyET74XsUr11BGD4wft3WqIS\\nXtCLeeJKrkyHbIusy2h6W3nhXMZT+kVPb+ecO+tQ1fOTv+8EzQj3qzfcdh6PnCbb\\nXscCFmBvuuAS97+6zfA0tKS4DCxAJMIugyV+QqqssntSnNjrhELyvBnl5QKBgQCk\\nx+ioZiQQomGIfmyXH3cE8dbuaqDlIIabtNuTfx3BS7KkbcsDLJQtvq/6eXeC5vkV\\nBHPpostf8CDnn8jy2U+KwMxBurn6o06tGBjbVkxFIsNwEeYSr7OH/0SftOVY53h8\\nUQhAguCbOsqvaTlLnGjf2V/3JKhm597vKfjNaFbhMQKBgQCb7+WkDN9Pc3n1gbo3\\nnZW7sTasIDj0MoZuMiM8J6R9EsD+hNJ/c5vpr4CeFaT4DTanhqLR6cCPR+Nqcl1T\\neB4IKarz04svwizzFSG0XDCVmKO3nM4Zai0zkAIFSZxIXG9pxmucOmx8DPrvlX/c\\nptO8AvBlmMvMiGlAMyDlKMUYSQ==\\n-----END PRIVATE KEY-----\" }, \"teacert\": { \"class\": \"Certificate\", \"remark\": \"tea.example.com\", \"certificate\": \"-----BEGIN CERTIFICATE-----\\nMIIDNjCCAh6gAwIBAgIEF6yK6DANBgkqhkiG9w0BAQsFADBdMQswCQYDVQQGEwJD\\nTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMQswCQYDVQQKEwJGNTENMAsGA1UE\\nCxMEVGVzdDEYMBYGA1UEAxMPdGVhLmV4YW1wbGUuY29tMB4XDTIyMDgwMzA4NDg0\\nMFoXDTMyMDczMTA4NDg0MFowXTELMAkGA1UEBhMCQ04xCzAJBgNVBAgTAlpKMQsw\\nCQYDVQQHEwJIWjELMAkGA1UEChMCRjUxDTALBgNVBAsTBFRlc3QxGDAWBgNVBAMT\\nD3RlYS5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB\\nAOxIFhA7yv1p4gzcbWR4x07f0zhKH8VfyWTRnw7QjZFUjNLbEa7bOhQt53V9oCSR\\nol/8tY22CmBSAtlmTt5FX5H6W6naU8EAZUmwHO3eXjp/a1HUk0fj4D++dJ8KEF0b\\nT2fxq4H+jYoTDE/Nr4u9TExuZfU/tcMsF3PrgIfkjydjW7peyJoxhvLt4tyk8z3a\\nkfSgs6mjlBuc5/2Y1tIStRpJ7gl+eKueDHp4ogPnx5qcg+GAM1pYiv17wKVJzcHW\\nDor0B4xVi3CQWlUlTwW1TX+pwL0JkoOOPfbNYo67G43DmG8m3WNG+FH+aIGXhyyp\\ncy4zbum4d1HZI/zp+k7qd6ECAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAlfg7nBJL\\nDQWDGjczOjZjOcHrM7jbfuadmZQAgmASGRLMaHNuj8RIG+Ro+znM6QYNB7S8E4ZF\\ntjfvamSoFSB5+YoOwFZlyWyiHhW1L22HB7G2JabtBhexWURNfsjrwkROGpRBqjGz\\neuq4x/kkRYkOGhWGyXmJQmPo2FjO2g4R1zIRGEMeij0xpPuYIZsA6BOuyYiJPvi0\\nFBSsc+udZqOz9/MzcrU2mmIX0N42XudhWbiXNe6izPvBsrztJoZA8gaHn99JgZcZ\\ngKLYKl6FW4aN5mh2XGwuS+smbD37vr4J3faZg+18KN+H6g8mbF/ArPxKP9fiM9u9\\npKTWOTrCU0hJkw==\\n-----END CERTIFICATE-----\", \"privateKey\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDsSBYQO8r9aeIM\\n3G1keMdO39M4Sh/FX8lk0Z8O0I2RVIzS2xGu2zoULed1faAkkaJf/LWNtgpgUgLZ\\nZk7eRV+R+lup2lPBAGVJsBzt3l46f2tR1JNH4+A/vnSfChBdG09n8auB/o2KEwxP\\nza+LvUxMbmX1P7XDLBdz64CH5I8nY1u6XsiaMYby7eLcpPM92pH0oLOpo5QbnOf9\\nmNbSErUaSe4Jfnirngx6eKID58eanIPhgDNaWIr9e8ClSc3B1g6K9AeMVYtwkFpV\\nJU8FtU1/qcC9CZKDjj32zWKOuxuNw5hvJt1jRvhR/miBl4csqXMuM27puHdR2SP8\\n6fpO6nehAgMBAAECggEAYScGw2gCgA5AXy9nX2917A2GKNf5lktbYLP8ZbgE7aPJ\\nP43KCI6lo9R4HkwoQ8EJ9dPPxtP6Ej7GYyN4/FWkBT7e38kgtPP3scPTMU9EiWMI\\n+p2gbWfaNfuWsioOLmpjTQcGkS3cftB0OIAHVTrhm2+tRpkKoJSJlCVaNQYagoPC\\nzhns8KJceDnyRikRfH0RbPPGsLLohnRYPDEs6J0yCXvUhKxsFKXq/mL0licu9KZN\\nqUwX2/TmT8iDnoC+TBkYJk055llBv16l5Hx7egYD9uNEFk76SInC2MCHpl1nlp43\\nEp5uRUsaCjS+5tpqugQPelhFQC9v7l4t4x+3xH/XPQKBgQD7riYMLVCNnSH3zRH8\\nYOwwFqGVSngTZw1hlTd06HEzUpntlHaoO3Z9pH2XWgaPF+2e2Hngm7EMNe5qjZau\\nlyOqb85UCxuAs0wLlLD/Q4sWOGmEPrkIHmKXHMZjQMjtqCkKr//zvE0W9ADo2MLm\\nawTxj45gTZxGXvuTEnMMkaflKwKBgQDwVkcXIJImgK+JXEjM1rGeypONVCnAqo7p\\nFJq2/QAraGvlNLv1QBzE6s4uqwWfzCecICQOoNrLG0dE3mHIlYgVqOK5Li9CJcsB\\n6dfEzgQyT4hotghCC/udjkAvKskXd4ShXbRSvF3p3elZDgXfAbQ5bxIL4QIOJF6f\\nd5os2LqIYwKBgQC3thDzxogMNuy6kyhTzvPYzkw4S1mG4Cw2VNNcNOecjOjrMPnE\\nJ1OAtvct6XrsLI04689bEoqT3TIg+SVKX+ya1m4HjuwOb9JMiccBLW5zU85Bx/8M\\nXBGfOFPf00RXpe3/bSUp5wNmg8m+LatmwiujoCRPS5eNDnwYiNkODaw+bQKBgG5Z\\nfvysdM5+6ZotKDP9I8LgCo2qph0TctisIDmCwvArWtb7to1t6Ye0tASTe9qaN1ml\\nHEknLC5zkO6bGNSra7deOvOBtCswBR0UzIBNg3nCMMS7R+FjdR0rcmb1wy0mMFyT\\nFLekS46U2I6ONL3nH2P7jpKrtnDd3CBmHwEWZdc3AoGBAM6ssZsvW47BGBbYNu7x\\nwEE0ehL/lesNQK9qEvBbtQ3w8ta5M9QHNu0vg05A6Pv+fLhSA+RuutAnF+bqBMpA\\nRM3JjvSRiMO51nISmVNl9Hga3vVvlUc7FDomv+KHc/RE6FqRdDRRvflErKb4sWDa\\nV4BS1wQmnyROovJMDN0A/mVi\\n-----END PRIVATE KEY-----\" } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/advancedhttp/#_8","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:38:34 description cafe destination 192.0.2.14:https ip-protocol tcp last-modified-time 2022-08-19:16:38:34 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/cafetls { context clientside } cafe/cafetls-1- { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 56 } ltm profile client-ssl cafe/cafetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/coffeecert.crt cert-key-chain { coffeecert { cert cafe/coffeecert.crt key cafe/coffeecert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/coffeecert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name coffee.example.com sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled } ltm profile client-ssl cafe/cafetls-1- { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate once c3d-drop-unknown-ocsp-status drop cache-timeout 3600 cert cafe/teacert.crt cert-key-chain { teacert { cert cafe/teacert.crt key cafe/teacert.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key cafe/teacert.key ocsp-stapling disabled peer-cert-mode ignore renegotiation enabled retain-certificate true server-name tea.example.com sni-default false sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/advancedhttp/#5","text":"","title":"5.\u53cc\u5411\u8ba4\u8bc1"},{"location":"Use-Cases/advancedhttp/#_9","text":"\u9664\u4e86\u51fa\u793a\u670d\u52a1\u5668\u8bc1\u4e66\u5916\uff0c\u5e94\u7528\u8fd8\u9700\u8981\u5bf9\u5ba2\u6237\u7aef\u8fdb\u884c\u8bc1\u4e66\u8ba4\u8bc1\uff0c\u9700\u8981\u5728F5\u4e0a\u914d\u7f6eCA\u8bc1\u4e66\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/advancedhttp/#yaml_4","text":"kind : ConfigMap apiVersion : v1 metadata : name : cis-c-6 namespace : default labels : f5type : virtual-server as3 : \"true\" data : template : | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.27.0\", \"remark\": \"HTTPS with bidirection auth\", \"cis-c-6\": { \"class\": \"Tenant\", \"cafe\": { \"class\": \"Application\", \"https_vs\": { \"class\": \"Service_HTTPS\", \"virtualAddresses\": [ \"192.0.2.15\" ], \"virtualPort\": 443, \"pool\": \"coffee_pool\", \"serverTLS\": \"coffeetls\", \"redirect80\": false }, \"coffee_pool\": { \"class\": \"Pool\", \"monitors\": [ \"http\" ], \"members\": [{ \"servicePort\": 80, \"serverAddresses\": [] }] }, \"coffeetls\": { \"class\": \"TLS_Server\", \"certificates\": [{ \"certificate\": \"coffeecert\" }], \"authenticationMode\": \"require\", \"authenticationFrequency\": \"every-time\", \"authenticationTrustCA\": \"coffeeca\" }, \"coffeecert\": { \"class\": \"Certificate\", \"remark\": \"coffee.example.com\", \"certificate\": { \"bigip\": \"/Common/default.crt\" }, \"privateKey\": { \"bigip\": \"/Common/default.key\" } }, \"coffeeca\": { \"class\": \"CA_Bundle\", \"bundle\": { \"bigip\": \"/Common/ca-bundle.crt\" } } } } } }","title":"\u53c2\u8003YAML"},{"location":"Use-Cases/advancedhttp/#_10","text":"ltm virtual cafe/https_vs { creation-time 2022-08-19:16:47:53 description cafe destination 192.0.2.15:https ip-protocol tcp last-modified-time 2022-08-19:16:47:53 mask 255.255.255.255 partition cis-c-6 persist { /Common/cookie { default yes } } pool cafe/coffee_pool profiles { /Common/f5-tcp-progressive { } /Common/http { } cafe/coffeetls { context clientside } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 57 } ltm profile client-ssl cafe/coffeetls { alert-timeout indefinite allow-expired-crl disabled app-service none authenticate always c3d-drop-unknown-ocsp-status drop ca-file /Common/ca-bundle.crt cache-timeout 3600 cert /Common/default.crt cert-key-chain { default { cert /Common/default.crt key /Common/default.key } } cert-lookup-by-ipaddr-port disabled cipher-group none ciphers DEFAULT inherit-ca-certkeychain true inherit-certkeychain false key /Common/default.key ocsp-stapling disabled peer-cert-mode require renegotiation enabled retain-certificate true server-name none sni-default true sni-require false ssl-c3d disabled ssl-forward-proxy disabled ssl-forward-proxy-bypass disabled }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/crossrefer/","text":"1.TCP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 TCP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684TCP profile\uff1acustomTCPProfile\uff0c \u4e14\u521b\u5efa\u4e86\u4e00\u4e2asnatpool\uff1aCreateSnatPool\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002 \u53c2\u8003yaml \u00b6 apiVersion: v1 kind: ConfigMap metadata: name: cm-as3-tcp-std-template-configmap namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"label\": \"snat_pool_existing\", \"remark\": \"reference_snat_pool\", \"Sample_TCP_Pool\": { \"class\": \"Tenant\", \"TCP_app\": { \"class\": \"Application\", \"test_service\": { \"class\": \"Service_TCP\", \"virtualPort\": 8181, \"virtualAddresses\": [ \"10.42.20.120\" ], \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"tcp_pool\", \"snat\": { \"use\": \"CreateSnatPool\" } }, \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"tcp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"CreateSnatPool\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"10.42.20.192\", \"10.42.20.193\" ] } } } } }","title":"Crossrefer"},{"location":"Use-Cases/crossrefer/#1tcp","text":"","title":"1.TCP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/crossrefer/#_1","text":"TCP\u4e1a\u52a1\u53d1\u5e03 \u793a\u4f8b\u4e2d\u521b\u5efa\u4e86\u5b9a\u5236\u5316\u7684TCP profile\uff1acustomTCPProfile\uff0c \u4e14\u521b\u5efa\u4e86\u4e00\u4e2asnatpool\uff1aCreateSnatPool\u3002 \u8bf7\u89c6\u9700\u8981\u4fee\u6539\u76f8\u5173\u53c2\u6570\u3002","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/crossrefer/#yaml","text":"apiVersion: v1 kind: ConfigMap metadata: name: cm-as3-tcp-std-template-configmap namespace: default labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"label\": \"snat_pool_existing\", \"remark\": \"reference_snat_pool\", \"Sample_TCP_Pool\": { \"class\": \"Tenant\", \"TCP_app\": { \"class\": \"Application\", \"test_service\": { \"class\": \"Service_TCP\", \"virtualPort\": 8181, \"virtualAddresses\": [ \"10.42.20.120\" ], \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"tcp_pool\", \"snat\": { \"use\": \"CreateSnatPool\" } }, \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"tcp_pool\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 80, \"serverAddresses\": [] } ] }, \"CreateSnatPool\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"10.42.20.192\", \"10.42.20.193\" ] } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/","text":"1.\u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03 HTTP\u4e1a\u52a1\u9ed8\u8ba4\u53c2\u6570\u8bf4\u660e\uff1a Snat\u4e3aauto\uff0c\u610f\u601d\u662fautomap persistenceMethods\u4e3acookie\uff0c\u610f\u601d\u9ed8\u8ba4\u4f1a\u8bdd\u4fdd\u6301\u662fcookie VS\u7c7b\u578b\u4e3astandard \u9ed8\u8ba4\u4f1a\u4f7f\u7528http profile \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-11 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vs1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.142.181\" ], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test005/app_svc_vs1 ltm virtual test005/app_svc_vs1 { creation-time 2022-08-02:16:28:32 description test005 destination 172.16.142.181:xfer ip-protocol tcp last-modified-time 2022-08-02:16:28:32 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 933 } 2.\u914d\u7f6evirtual address\u5c5e\u6027\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6evirtual address\u5bf9\u8c61, arp enable no\uff0c virtual server \u5f15\u7528\u8be5\u5bf9\u8c61 \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-2 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:16:43:17 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:16:43:17 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 934 } list ltm virtual-address 172.16.142.178 ltm virtual-address 172.16.142.178 { address 172.16.142.178 arp disabled inherited-traffic-group true mask 255.255.255.255 partition test005 traffic-group /Common/traffic-group-1 } 3.\u914d\u7f6eTCP profile\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eTCP profile\uff0c\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4 \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-3 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:17:04:31 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:17:04:31 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/http { } test005/customTCPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 935 } list ltm profile tcp test005/customTCPProfile | grep idle-timeout idle-timeout 600 4.\u914d\u7f6eHTTP profile\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eHTTP profile\uff0c\u5f00\u542fXFF \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-4 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"customHTTPProfile\": { \"class\": \"HTTP_Profile\", \"xForwardedFor\": true }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip4\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.188\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip4\" }], \"virtualPort\": 82, \"profileHTTP\": { \"use\": \"customHTTPProfile\" }, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs2 ltm virtual test006/app_svc_vs2 { creation-time 2022-08-02:17:57:57 description test006 destination 172.16.142.188:xfer ip-protocol tcp last-modified-time 2022-08-02:17:57:57 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } test006/customHTTPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 946 } list ltm profile http test006/customHTTPProfile | grep \"insert-xforwarded-for\" insert-xforwarded-for enabled 5.\u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0ccookie\u52a0\u5bc6\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0c\u5bf9F5 insert\u7684cookie\u8fdb\u884c\u52a0\u5bc6 \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"cookie_encryption\": { \"class\": \"Persist\", \"persistenceMethod\": \"cookie\", \"encrypt\": true, \"cookieMethod\": \"insert\", \"passphrase\": { \"ciphertext\": \"a3RjeGZ5Z2Q=\", \"protected\": \"eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0=\" } }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"persistenceMethods\": [{ \"use\": \"cookie_encryption\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:31:30 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:31:30 mask 255.255.255.255 partition test006 persist { test006/cookie_encryption { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 939 } list ltm persistence cookie test006/cookie_encryption ltm persistence cookie test006/cookie_encryption { always-send disabled app-service none cookie-encryption required cookie-encryption-passphrase $M$t7$uQ0K+M40jOAbMER6IY+BSA== cookie-name none expiration 0 httponly enabled match-across-pools disabled match-across-services disabled match-across-virtuals disabled method insert mirror disabled override-connection-limit disabled secure enabled timeout indefinite } 6.\u914d\u7f6esnat pool\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6esnat pool\u8303\u4f8b \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"snatpool-3\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"172.16.142.21\", \"172.16.142.22\" ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"snat\": { \"use\": \"snatpool-3\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:36:04 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:36:04 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool test006/snatpool-3 type snat } translate-address enabled translate-port enabled vs-index 940 } list ltm snatpool test006/snatpool-3 ltm snatpool test006/snatpool-3 { members { 172.16.142.21 172.16.142.22 } partition test006 } 7.\u914d\u7f6eone connect\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eone connect\u8303\u4f8b \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"customOne\": { \"class\": \"Multiplex_Profile\", \"sourceMask\": \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"profileMultiplex\": { \"use\": \"customOne\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:40:20 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:40:20 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } test006/customOne { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 941 } list ltm profile one-connect test006/customOne ltm profile one-connect test006/customOne { app-service none idle-timeout-override disabled limit-type none max-age 86400 max-reuse 1000 max-size 10000 share-pools disabled source-mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff } 8.\u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { connection-limit 123 creation-time 2022-08-03:09:51:12 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:51:12 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled service-down-immediate-action reset source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 943 } 9.\u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 \u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"iRulesTest1\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"iRulesTest2\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"iRules\": [{ \"use\": \"iRulesTest1\" },{ \"use\": \"iRulesTest2\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:46:05 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:46:05 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { test006/iRulesTest1 test006/iRulesTest2 } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 942 } list ltm rule test006/iRulesTest1 ltm rule test006/iRulesTest1 { partition test006 when CLIENT_ACCEPTED { } } list ltm rule test006/iRulesTest2 ltm rule test006/iRulesTest2 { partition test006 when CLIENT_ACCEPTED { } } 10.\u914d\u7f6e\u591a\u4e2amonitor\u8303\u4f8b \u00b6 \u573a\u666f\u63cf\u8ff0 \u00b6 pool\u4e2d\u914d\u7f6e\u591a\u4e2amonitor \u53c2\u8003yaml \u00b6 kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"monitorTcp1\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 10, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"monitorTcp2\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 7, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ { \"use\": \"monitorTcp1\" }, { \"use\": \"monitorTcp2\" } ], \"minimumMonitors\": \"all\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } } \u90e8\u7f72\u7ed3\u679c \u00b6 list ltm pool test006/pool3 ltm pool test006/pool3 { min-active-members 1 monitor test006/monitorTcp1 and test006/monitorTcp2 partition test006 } 11.\u5e38\u7528irules\u8303\u4f8b \u00b6 \u6839\u636eURI\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if { [HTTP::uri] starts_with \\\"/coffee\\\" } {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else { \\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n \\n}\" }, \u5176\u4e2d if { [HTTP::uri] starts_with \\\"/coffee\\\" } \u8868\u793a\u65b0\u7684\u7248\u672c\u4e2d\u4ee5/coffee\u76ee\u5f55\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65b0\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a\uff0c {\\n pool k8s-cib001-svc-1-pool-8080 \\n } \u5176\u4e2d\u7684pool\u662f\u65b0\u7248\u672c\u670d\u52a1\u5668\u7684\u5730\u5740\u6c60 \u5982\u679c\u4e0d\u662f\u4ee5/coffee\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65e7\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a \u6839\u636e\u5ba2\u6237\u7aefip\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[IP::addr [IP::client_addr] equals 192.168.5.30] or [IP::addr [IP::client_addr] equals 192.168.5.0/24]} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5f53\u7ec8\u7aef\u5730\u5740\u4e3a192.168.5.30\u6216\u8005\u5c5e\u4e8e192.168.5.0/24\u7684\u7f51\u6bb5\uff0c\u8be5\u8bf7\u6c42\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u60c5\u51b5\u6d41\u91cf\u5747\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c \u6839\u636ecookie\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::cookie exists \\\"Canary\\\"] and [HTTP::cookie value \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5982\u679c\u53ef\u4ee5\u5b58\u5728cookie\u4e3aCanary\uff0c\u800c\u4e14\u5bf9\u5e94\u8be5cookie\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u6240\u6709\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c \u6839\u636ehttp header\u8fdb\u884c\u8f6c\u53d1 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::header exists \\\"Canary\\\"] and [HTTP::header values \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2dhttp header\u4e2d\u5982\u679c\u5b58\u5728\\\"Canary\\\"\uff0c\u4e14\u5bf9\u5e94\u7684value\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u60c5\u51b5\u6d41\u91cf\u5206\u7ed9 k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c \u6839\u636e\u6bd4\u4f8b\u8fdb\u884c\u7070\u5ea6 \u00b6 \"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[expr {[expr {0xffffffff & [crc32 [IP::client_addr]]}] % 100}] < 25} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d< 25 \u662f 25%\u7684\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 75%\u7684\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"Simplehttp"},{"location":"Use-Cases/simplehttp/#1http","text":"","title":"1.\u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_1","text":"\u6807\u51c6HTTP\u4e1a\u52a1\u53d1\u5e03 HTTP\u4e1a\u52a1\u9ed8\u8ba4\u53c2\u6570\u8bf4\u660e\uff1a Snat\u4e3aauto\uff0c\u610f\u601d\u662fautomap persistenceMethods\u4e3acookie\uff0c\u610f\u601d\u9ed8\u8ba4\u4f1a\u8bdd\u4fdd\u6301\u662fcookie VS\u7c7b\u578b\u4e3astandard \u9ed8\u8ba4\u4f1a\u4f7f\u7528http profile","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-11 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vs1\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [ \"172.16.142.181\" ], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_2","text":"list ltm virtual test005/app_svc_vs1 ltm virtual test005/app_svc_vs1 { creation-time 2022-08-02:16:28:32 description test005 destination 172.16.142.181:xfer ip-protocol tcp last-modified-time 2022-08-02:16:28:32 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 933 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#2virtual-address","text":"","title":"2.\u914d\u7f6evirtual address\u5c5e\u6027\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_3","text":"\u914d\u7f6evirtual address\u5bf9\u8c61, arp enable no\uff0c virtual server \u5f15\u7528\u8be5\u5bf9\u8c61","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_1","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-2 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_4","text":"list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:16:43:17 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:16:43:17 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 934 } list ltm virtual-address 172.16.142.178 ltm virtual-address 172.16.142.178 { address 172.16.142.178 arp disabled inherited-traffic-group true mask 255.255.255.255 partition test005 traffic-group /Common/traffic-group-1 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#3tcp-profile","text":"","title":"3.\u914d\u7f6eTCP profile\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_5","text":"\u914d\u7f6eTCP profile\uff0c\u81ea\u5b9a\u4e49\u8d85\u65f6\u65f6\u95f4","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_2","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-3 namespace: f5-test005 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test005\": { \"class\": \"Tenant\", \"test005\": { \"class\": \"Application\", \"template\": \"generic\", \"customTCPProfile\": { \"class\": \"TCP_Profile\", \"idleTimeout\": 600 }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.178\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip\" }], \"virtualPort\": 82, \"profileTCP\": { \"use\": \"customTCPProfile\" }, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_6","text":"list ltm virtual test005/app_svc_vs2 ltm virtual test005/app_svc_vs2 { creation-time 2022-08-02:17:04:31 description test005 destination 172.16.142.178:xfer ip-protocol tcp last-modified-time 2022-08-02:17:04:31 mask 255.255.255.255 partition test005 persist { /Common/cookie { default yes } } pool test005/pool3 profiles { /Common/http { } test005/customTCPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 935 } list ltm profile tcp test005/customTCPProfile | grep idle-timeout idle-timeout 600","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#4http-profile","text":"","title":"4.\u914d\u7f6eHTTP profile\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_7","text":"\u914d\u7f6eHTTP profile\uff0c\u5f00\u542fXFF","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_3","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-4 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"customHTTPProfile\": { \"class\": \"HTTP_Profile\", \"xForwardedFor\": true }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip4\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.188\", \"arpEnabled\": false }, \"app_svc_vs2\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip4\" }], \"virtualPort\": 82, \"profileHTTP\": { \"use\": \"customHTTPProfile\" }, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_8","text":"list ltm virtual test006/app_svc_vs2 ltm virtual test006/app_svc_vs2 { creation-time 2022-08-02:17:57:57 description test006 destination 172.16.142.188:xfer ip-protocol tcp last-modified-time 2022-08-02:17:57:57 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } test006/customHTTPProfile { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 946 } list ltm profile http test006/customHTTPProfile | grep \"insert-xforwarded-for\" insert-xforwarded-for enabled","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#5cookiecookie","text":"","title":"5.\u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0ccookie\u52a0\u5bc6\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_9","text":"\u914d\u7f6ecookie\u4f1a\u8bdd\u4fdd\u6301\uff0c\u5bf9F5 insert\u7684cookie\u8fdb\u884c\u52a0\u5bc6","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_4","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"cookie_encryption\": { \"class\": \"Persist\", \"persistenceMethod\": \"cookie\", \"encrypt\": true, \"cookieMethod\": \"insert\", \"passphrase\": { \"ciphertext\": \"a3RjeGZ5Z2Q=\", \"protected\": \"eyJhbGciOiJkaXIiLCJlbmMiOiJub25lIn0=\" } }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"persistenceMethods\": [{ \"use\": \"cookie_encryption\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_10","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:31:30 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:31:30 mask 255.255.255.255 partition test006 persist { test006/cookie_encryption { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 939 } list ltm persistence cookie test006/cookie_encryption ltm persistence cookie test006/cookie_encryption { always-send disabled app-service none cookie-encryption required cookie-encryption-passphrase $M$t7$uQ0K+M40jOAbMER6IY+BSA== cookie-name none expiration 0 httponly enabled match-across-pools disabled match-across-services disabled match-across-virtuals disabled method insert mirror disabled override-connection-limit disabled secure enabled timeout indefinite }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#6snat-pool","text":"","title":"6.\u914d\u7f6esnat pool\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_11","text":"\u914d\u7f6esnat pool\u8303\u4f8b","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_5","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"snatpool-3\": { \"class\": \"SNAT_Pool\", \"snatAddresses\": [ \"172.16.142.21\", \"172.16.142.22\" ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"snat\": { \"use\": \"snatpool-3\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_12","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:36:04 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:36:04 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { pool test006/snatpool-3 type snat } translate-address enabled translate-port enabled vs-index 940 } list ltm snatpool test006/snatpool-3 ltm snatpool test006/snatpool-3 { members { 172.16.142.21 172.16.142.22 } partition test006 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#7one-connect","text":"","title":"7.\u914d\u7f6eone connect\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_13","text":"\u914d\u7f6eone connect\u8303\u4f8b","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_6","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"customOne\": { \"class\": \"Multiplex_Profile\", \"sourceMask\": \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"profileMultiplex\": { \"use\": \"customOne\" }, \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_14","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:40:20 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:40:20 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } test006/customOne { } } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 941 } list ltm profile one-connect test006/customOne ltm profile one-connect test006/customOne { app-service none idle-timeout-override disabled limit-type none max-age 86400 max-reuse 1000 max-size 10000 share-pools disabled source-mask ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#8vs-immediate-action-on-svc-down","text":"","title":"8.\u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_15","text":"\u914d\u7f6eVS \u94fe\u63a5\u9650\u5236\uff0c immediate action on svc down","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_7","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_16","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { connection-limit 123 creation-time 2022-08-03:09:51:12 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:51:12 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } serverssl-use-sni disabled service-down-immediate-action reset source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 943 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#9vsirules","text":"","title":"9.\u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_17","text":"\u914d\u7f6eVS\u5173\u8054\u591a\u4e2aiRules","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_8","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"pool3\": { \"class\": \"Pool\", \"monitors\": [ \"tcp\" ], \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"iRulesTest1\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"iRulesTest2\": { \"class\": \"iRule\", \"iRule\": \"when CLIENT_ACCEPTED {\\n \\n }\" }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"iRules\": [{ \"use\": \"iRulesTest1\" },{ \"use\": \"iRulesTest2\" }], \"virtualPort\": 82, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_18","text":"list ltm virtual test006/app_svc_vs6 ltm virtual test006/app_svc_vs6 { creation-time 2022-08-03:09:46:05 description test006 destination 172.16.142.186:xfer ip-protocol tcp last-modified-time 2022-08-03:09:46:05 mask 255.255.255.255 partition test006 persist { /Common/cookie { default yes } } pool test006/pool3 profiles { /Common/f5-tcp-progressive { } /Common/http { } } rules { test006/iRulesTest1 test006/iRulesTest2 } serverssl-use-sni disabled source 0.0.0.0/0 source-address-translation { type automap } translate-address enabled translate-port enabled vs-index 942 } list ltm rule test006/iRulesTest1 ltm rule test006/iRulesTest1 { partition test006 when CLIENT_ACCEPTED { } } list ltm rule test006/iRulesTest2 ltm rule test006/iRulesTest2 { partition test006 when CLIENT_ACCEPTED { } }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#10monitor","text":"","title":"10.\u914d\u7f6e\u591a\u4e2amonitor\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#_19","text":"pool\u4e2d\u914d\u7f6e\u591a\u4e2amonitor","title":"\u573a\u666f\u63cf\u8ff0"},{"location":"Use-Cases/simplehttp/#yaml_9","text":"kind: ConfigMap apiVersion: v1 metadata: name: app-as3-6 namespace: f5-test006 labels: f5type: virtual-server as3: \"true\" data: template: | { \"class\": \"AS3\", \"action\": \"deploy\", \"persist\": true, \"declaration\": { \"class\": \"ADC\", \"schemaVersion\": \"3.28.0\", \"remark\": \"HTTP application\", \"test006\": { \"class\": \"Tenant\", \"test006\": { \"class\": \"Application\", \"template\": \"generic\", \"monitorTcp1\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 10, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"monitorTcp2\": { \"class\": \"Monitor\", \"monitorType\": \"tcp\", \"timeout\": 7, \"interval\": 2, \"send\": \"\", \"receive\": \"\" }, \"pool3\": { \"class\": \"Pool\", \"monitors\": [ { \"use\": \"monitorTcp1\" }, { \"use\": \"monitorTcp2\" } ], \"minimumMonitors\": \"all\", \"members\": [ { \"servicePort\": 8080, \"serverAddresses\": [ ] } ] }, \"app_svc_vip6\": { \"class\": \"Service_Address\", \"virtualAddress\": \"172.16.142.186\", \"arpEnabled\": false }, \"app_svc_vs6\": { \"class\": \"Service_HTTP\", \"virtualAddresses\": [{ \"use\": \"app_svc_vip6\" }], \"virtualPort\": 82, \"serviceDownImmediateAction\": \"reset\", \"maxConnections\": 123, \"pool\": \"pool3\" } } } } }","title":"\u53c2\u8003yaml"},{"location":"Use-Cases/simplehttp/#_20","text":"list ltm pool test006/pool3 ltm pool test006/pool3 { min-active-members 1 monitor test006/monitorTcp1 and test006/monitorTcp2 partition test006 }","title":"\u90e8\u7f72\u7ed3\u679c"},{"location":"Use-Cases/simplehttp/#11irules","text":"","title":"11.\u5e38\u7528irules\u8303\u4f8b"},{"location":"Use-Cases/simplehttp/#uri","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if { [HTTP::uri] starts_with \\\"/coffee\\\" } {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else { \\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n \\n}\" }, \u5176\u4e2d if { [HTTP::uri] starts_with \\\"/coffee\\\" } \u8868\u793a\u65b0\u7684\u7248\u672c\u4e2d\u4ee5/coffee\u76ee\u5f55\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65b0\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a\uff0c {\\n pool k8s-cib001-svc-1-pool-8080 \\n } \u5176\u4e2d\u7684pool\u662f\u65b0\u7248\u672c\u670d\u52a1\u5668\u7684\u5730\u5740\u6c60 \u5982\u679c\u4e0d\u662f\u4ee5/coffee\u5f00\u5934\u7684\u90fd\u4f1a\u5206\u5f80\u65e7\u7248\u672c\u7684\u670d\u52a1\u5668\u4e0a","title":"\u6839\u636eURI\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/simplehttp/#ip","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[IP::addr [IP::client_addr] equals 192.168.5.30] or [IP::addr [IP::client_addr] equals 192.168.5.0/24]} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5f53\u7ec8\u7aef\u5730\u5740\u4e3a192.168.5.30\u6216\u8005\u5c5e\u4e8e192.168.5.0/24\u7684\u7f51\u6bb5\uff0c\u8be5\u8bf7\u6c42\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u60c5\u51b5\u6d41\u91cf\u5747\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636e\u5ba2\u6237\u7aefip\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/simplehttp/#cookie","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::cookie exists \\\"Canary\\\"] and [HTTP::cookie value \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d\u5982\u679c\u53ef\u4ee5\u5b58\u5728cookie\u4e3aCanary\uff0c\u800c\u4e14\u5bf9\u5e94\u8be5cookie\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u7684\u6240\u6709\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636ecookie\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/simplehttp/#http-header","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when HTTP_REQUEST {\\n if {[HTTP::header exists \\\"Canary\\\"] and [HTTP::header values \\\"Canary\\\"] equals \\\"true\\\"} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2dhttp header\u4e2d\u5982\u679c\u5b58\u5728\\\"Canary\\\"\uff0c\u4e14\u5bf9\u5e94\u7684value\u503c\u4e3atrue\uff0c\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 \u5176\u5b83\u60c5\u51b5\u6d41\u91cf\u5206\u7ed9 k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636ehttp header\u8fdb\u884c\u8f6c\u53d1"},{"location":"Use-Cases/simplehttp/#_21","text":"\"irule_k8s-cib001-svc-1\": { \"class\": \"iRule\", \"remark\": \"switch between pools\", \"iRule\": \"when CLIENT_ACCEPTED {\\n if {[expr {[expr {0xffffffff & [crc32 [IP::client_addr]]}] % 100}] < 25} {\\n pool k8s-cib001-svc-1-pool-8080 \\n } else {\\n pool k8s-cib001-app-svc-4-pool-8080 \\n }\\n}\" }, \u5176\u4e2d< 25 \u662f 25%\u7684\u6d41\u91cf\u5206\u7ed9 pool k8s-cib001-svc-1-pool-8080 75%\u7684\u6d41\u91cf\u5206\u5f80 pool k8s-cib001-app-svc-1-pool-8080 \u6ce8\u610f\u4e00\u4e0b\u5982\u4e0airule\u7684\u5199\u6cd5\uff0c \\n \u8868\u793a\u6362\u884c","title":"\u6839\u636e\u6bd4\u4f8b\u8fdb\u884c\u7070\u5ea6"},{"location":"quick-start/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"Prerequisites"},{"location":"quick-start/#check-later","text":"","title":"Check later"},{"location":"quick-start/#1-xxx","text":"We will be back","title":"1. XXX"},{"location":"quick-start/installation/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"Installing guide"},{"location":"quick-start/installation/#check-later","text":"","title":"Check later"},{"location":"quick-start/installation/#1-xxx","text":"We will be back","title":"1. XXX"},{"location":"quick-start/uninstall/","text":"Check later \u00b6 1. XXX \u00b6 We will be back","title":"Unstalling guide"},{"location":"quick-start/uninstall/#check-later","text":"","title":"Check later"},{"location":"quick-start/uninstall/#1-xxx","text":"We will be back","title":"1. XXX"}]}